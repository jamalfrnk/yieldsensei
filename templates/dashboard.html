{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
    <!-- Search Bar -->
    <div class="bg-gray-900 rounded-lg p-4">
        <form action="/search" method="GET" class="flex space-x-4">
            <input type="text" name="token" placeholder="Enter token symbol or contract address" 
                   class="flex-1 bg-black border border-orange-500 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <button type="submit" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500">
                Analyze
            </button>
        </form>
    </div>

    {% if error %}
    <div class="bg-red-900 text-white rounded-lg p-4">
        {{ error }}
    </div>
    {% endif %}

    <!-- Market Overview -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <h3 class="text-lg font-semibold text-orange-500 mb-2">{{ token_symbol }}</h3>
            <p class="text-2xl mt-2">${{ "%.2f"|format(price|float) }}</p>
            <p class="text-sm text-gray-400">24h Change: 
                <span class="{% if price_change >= 0 %}text-green-500{% else %}text-red-500{% endif %}">
                    {{ "%.2f"|format(price_change|float) }}%
                </span>
            </p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <div class="flex items-center mb-2">
                <h3 class="text-lg font-semibold text-orange-500">Signal Strength</h3>
                <div class="ml-2 group relative">
                    <span class="cursor-help text-orange-500">ⓘ</span>
                    <div class="opacity-0 bg-black text-white text-sm rounded-lg py-2 px-3 absolute z-10 bottom-full mb-2 -left-1/2 pointer-events-none group-hover:opacity-100 transition-opacity duration-200 w-64">
                        A measure of how strong the trading signal is, based on multiple technical indicators including RSI, MACD, and price levels. Higher values indicate stronger signals.
                    </div>
                </div>
            </div>
            <p class="text-2xl mt-2">{{ "%.1f"|format(signal_strength|float) }}/100</p>
            <p class="text-sm text-gray-400">{{ signal_description }}</p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <div class="flex items-center mb-2">
                <h3 class="text-lg font-semibold text-orange-500">Trend Score</h3>
                <div class="ml-2 group relative">
                    <span class="cursor-help text-orange-500">ⓘ</span>
                    <div class="opacity-0 bg-black text-white text-sm rounded-lg py-2 px-3 absolute z-10 bottom-full mb-2 -left-1/2 pointer-events-none group-hover:opacity-100 transition-opacity duration-200 w-64">
                        A score from 0-100 indicating the strength and direction of the current market trend. Higher scores suggest stronger upward trends, while lower scores indicate stronger downward trends.
                    </div>
                </div>
            </div>
            <p class="text-2xl mt-2">{{ "%.2f"|format(trend_score|float) }}/100</p>
            <p class="text-sm text-gray-400">{{ trend_direction }}</p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <div class="flex items-center mb-2">
                <h3 class="text-lg font-semibold text-orange-500">Market Status</h3>
                <div class="ml-2 group relative">
                    <span class="cursor-help text-orange-500">ⓘ</span>
                    <div class="opacity-0 bg-black text-white text-sm rounded-lg py-2 px-3 absolute z-10 bottom-full mb-2 -left-1/2 pointer-events-none group-hover:opacity-100 transition-opacity duration-200 w-64">
                        Indicates whether the market is overbought (RSI > 70), oversold (RSI < 30), or neutral. This helps identify potential reversal points and market extremes.
                    </div>
                </div>
            </div>
            <p class="text-2xl mt-2">{{ market_status }}</p>
            <p class="text-sm text-gray-400">RSI: {{ "%.1f"|format(rsi|float) }}</p>
        </div>
    </div>

    <!-- Price Chart -->
    <div class="bg-gray-900 rounded-lg p-4">
        <h2 class="text-xl font-bold text-orange-500 mb-4">Price Chart</h2>
        <div class="relative" style="height: 400px;">
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <!-- Support/Resistance Levels and Trading Strategy -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-900 rounded-lg p-4">
            <h2 class="text-xl font-bold text-orange-500 mb-4">Key Levels</h2>
            <div class="space-y-2">
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Resistance 2:</span>
                    <span class="text-red-500">${{ "%.2f"|format(resistance_2|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Resistance 1:</span>
                    <span class="text-red-400">${{ "%.2f"|format(resistance_1|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Current Price:</span>
                    <span class="text-white">${{ "%.2f"|format(price|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Support 1:</span>
                    <span class="text-green-400">${{ "%.2f"|format(support_1|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Support 2:</span>
                    <span class="text-green-500">${{ "%.2f"|format(support_2|float) }}</span>
                </div>
            </div>
        </div>

        <!-- Trading Strategy -->
        <div class="bg-gray-900 rounded-lg p-4">
            <div class="flex items-center mb-4">
                <h2 class="text-xl font-bold text-orange-500">Trading Strategy</h2>
                <div class="ml-2 group relative">
                    <span class="cursor-help text-orange-500">ⓘ</span>
                    <div class="opacity-0 bg-black text-white text-sm rounded-lg py-2 px-3 absolute z-10 bottom-full mb-2 -left-1/2 pointer-events-none group-hover:opacity-100 transition-opacity duration-200 w-64">
                        Personalized trading recommendations based on current market conditions, technical analysis, and risk management principles. These strategies suggest optimal entry points and position sizing using Dollar Cost Averaging (DCA).
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div class="bg-black bg-opacity-50 p-3 rounded">
                    <h3 class="text-orange-500 font-semibold mb-2">Trade Recommendation:</h3>
                    <p class="text-sm whitespace-pre-line mb-4">{{ dca_recommendation }}</p>
                </div>
                <div class="bg-black bg-opacity-50 p-3 rounded">
                    <h3 class="text-orange-500 font-semibold mb-2">Entry Strategy:</h3>
                    <p>Optimal Entry: ${{ "%.2f"|format(optimal_entry|float) }}</p>
                    <p>Stop Loss: ${{ "%.2f"|format(stop_loss|float) }}</p>
                </div>
                <div class="bg-black bg-opacity-50 p-3 rounded">
                    <h3 class="text-orange-500 font-semibold mb-2">Exit Strategy:</h3>
                    <p>Take Profit: ${{ "%.2f"|format(optimal_exit|float) }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Bot Integration -->
    <div class="bg-gray-900 rounded-lg p-4 mt-6">
        <h2 class="text-xl font-bold text-orange-500 mb-4">Get More with YieldSensei Bot</h2>
        <p class="text-gray-300 mb-4">Access these features and more through our Telegram bot:</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">Real-time Signals</h3>
                <p class="text-sm text-gray-400">Get instant trading signals with /signal command</p>
            </div>
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">Market Data</h3>
                <p class="text-sm text-gray-400">Check market stats with /market command</p>
            </div>
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">DEX Analytics</h3>
                <p class="text-sm text-gray-400">Analyze DEX pairs with /dexinfo command</p>
            </div>
        </div>
        <div class="mt-6 text-center">
            <a href="https://t.me/yieldsensei_bot" target="_blank" 
               class="inline-block bg-orange-500 text-white px-8 py-3 rounded-lg hover:bg-orange-600 transition-colors duration-200">
                Open Telegram Bot
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    const chartData = {{ chart_data|tojson }};

    // Format dates for x-axis
    const labels = chartData.labels.map(timestamp => {
        return new Date(timestamp).toLocaleDateString();
    });

    // Create gradient for line
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(249, 115, 22, 0.4)');
    gradient.addColorStop(1, 'rgba(249, 115, 22, 0)');

    // Create the chart
    window.priceChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Price',
                    data: chartData.prices,
                    borderColor: 'rgb(249, 115, 22)',
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 2,
                    pointHoverRadius: 5,
                    borderWidth: 2
                },
                {
                    label: 'Support 1',
                    data: Array(labels.length).fill(chartData.support_levels[0]),
                    borderColor: 'rgb(50, 205, 50)', // Lime green
                    borderDash: [5, 5],
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Support 2',
                    data: Array(labels.length).fill(chartData.support_levels[1]),
                    borderColor: 'rgb(0, 100, 0)', // Dark green
                    borderDash: [5, 5],
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Resistance 1',
                    data: Array(labels.length).fill(chartData.resistance_levels[0]),
                    borderColor: 'rgb(128, 128, 128)', // Grey
                    borderDash: [5, 5],
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Resistance 2',
                    data: Array(labels.length).fill(chartData.resistance_levels[1]),
                    borderColor: 'rgb(255, 0, 0)', // Red
                    borderDash: [5, 5],
                    fill: false,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#FFF',
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#FFF',
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: '#FFF',
                        usePointStyle: true,
                        padding: 20
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    titleColor: '#F97316',
                    bodyColor: '#FFFFFF',
                    padding: 12,
                    displayColors: true,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += '$' + context.parsed.y.toLocaleString();
                            }
                            return label;
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}