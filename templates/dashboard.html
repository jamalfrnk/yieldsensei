{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
    <!-- Search Bar -->
    <div class="bg-gray-900 rounded-lg p-4">
        <form action="/search" method="GET" class="flex space-x-4">
            <input type="text" name="token" placeholder="Enter token symbol or contract address" 
                   class="flex-1 bg-black border border-orange-500 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <button type="submit" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500">
                Analyze
            </button>
        </form>
    </div>

    {% if error %}
    <div class="bg-red-900 text-white rounded-lg p-4">
        {{ error }}
    </div>
    {% endif %}

    <!-- Market Overview -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <h3 class="text-lg font-semibold text-orange-500 mb-2">{{ token_symbol }}</h3>
            <p class="text-2xl mt-2">${{ "%.2f"|format(price|float) }}</p>
            <p class="text-sm text-gray-400">24h Change: 
                <span class="{% if price_change >= 0 %}text-green-500{% else %}text-red-500{% endif %}">
                    {{ "%.2f"|format(price_change|float) }}%
                </span>
            </p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <h3 class="text-lg font-semibold text-orange-500">Signal Strength</h3>
            <p class="text-2xl mt-2">{{ "%.1f"|format(signal_strength|float) }}%</p>
            <p class="text-sm text-gray-400">{{ signal_description }}</p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <h3 class="text-lg font-semibold text-orange-500">Trend Score</h3>
            <p class="text-2xl mt-2">{{ "%.2f"|format(trend_score|float) }}/100</p>
            <p class="text-sm text-gray-400">{{ trend_direction }}</p>
        </div>
        <div class="bg-gray-900 rounded-lg p-4 border border-orange-500 hover:bg-gray-800 transition-colors duration-200">
            <h3 class="text-lg font-semibold text-orange-500">Market Status</h3>
            <p class="text-2xl mt-2">{{ market_status }}</p>
            <p class="text-sm text-gray-400">RSI: {{ "%.1f"|format(rsi|float) }}</p>
        </div>
    </div>

    <!-- Price Chart -->
    <div class="bg-gray-900 rounded-lg p-4">
        <h2 class="text-xl font-bold text-orange-500 mb-4">Price Levels</h2>
        <div class="relative" style="height: 300px;">
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <!-- Support/Resistance Levels and DCA Recommendations -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-900 rounded-lg p-4">
            <h2 class="text-xl font-bold text-orange-500 mb-4">Key Levels</h2>
            <div class="space-y-2">
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Resistance 2:</span>
                    <span class="text-red-500">${{ "%.2f"|format(resistance_2|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Resistance 1:</span>
                    <span class="text-red-400">${{ "%.2f"|format(resistance_1|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Current Price:</span>
                    <span class="text-white">${{ "%.2f"|format(price|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Support 1:</span>
                    <span class="text-green-400">${{ "%.2f"|format(support_1|float) }}</span>
                </div>
                <div class="flex justify-between items-center p-2 hover:bg-gray-800 rounded transition-colors duration-200">
                    <span>Support 2:</span>
                    <span class="text-green-500">${{ "%.2f"|format(support_2|float) }}</span>
                </div>
            </div>
        </div>

        <!-- DCA Recommendations -->
        <div class="bg-gray-900 rounded-lg p-4">
            <h2 class="text-xl font-bold text-orange-500 mb-4">Trading Strategy</h2>
            <div class="space-y-2">
                <p class="text-sm whitespace-pre-line">{{ dca_recommendation }}</p>
            </div>
        </div>
    </div>

    <!-- Telegram Bot Integration -->
    <div class="bg-gray-900 rounded-lg p-4 mt-6">
        <h2 class="text-xl font-bold text-orange-500 mb-4">Get More with YieldSensei Bot</h2>
        <p class="text-gray-300 mb-4">Access these features and more through our Telegram bot:</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">Real-time Signals</h3>
                <p class="text-sm text-gray-400">Get instant trading signals with /signal command</p>
            </div>
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">Market Data</h3>
                <p class="text-sm text-gray-400">Check market stats with /market command</p>
            </div>
            <div class="p-4 bg-black rounded-lg border border-orange-500">
                <h3 class="text-lg font-semibold text-orange-500 mb-2">DEX Analytics</h3>
                <p class="text-sm text-gray-400">Analyze DEX pairs with /dexinfo command</p>
            </div>
        </div>
        <div class="mt-6 text-center">
            <a href="https://t.me/yieldsensei_bot" target="_blank" 
               class="inline-block bg-orange-500 text-white px-8 py-3 rounded-lg hover:bg-orange-600 transition-colors duration-200">
                Open Telegram Bot
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    const chartData = {{ chart_data|tojson }};

    // Update chart colors to match theme
    chartData.datasets[0].backgroundColor = [
        'rgba(34, 197, 94, 0.2)',  // Support 2 - Light green
        'rgba(34, 197, 94, 0.4)',  // Support 1 - Darker green
        'rgba(249, 115, 22, 0.6)', // Current - Orange
        'rgba(239, 68, 68, 0.4)',  // Resistance 1 - Light red
        'rgba(239, 68, 68, 0.2)'   // Resistance 2 - Darker red
    ];
    chartData.datasets[0].borderColor = [
        'rgb(34, 197, 94)',  // Support 2
        'rgb(34, 197, 94)',  // Support 1
        'rgb(249, 115, 22)', // Current price
        'rgb(239, 68, 68)',  // Resistance 1
        'rgb(239, 68, 68)'   // Resistance 2
    ];

    window.priceChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 750,
                easing: 'easeInOutQuart'
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: getComputedStyle(document.documentElement)
                            .getPropertyValue('--chart-grid').trim()
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement)
                            .getPropertyValue('--text-primary').trim(),
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                },
                x: {
                    grid: {
                        color: getComputedStyle(document.documentElement)
                            .getPropertyValue('--chart-grid').trim()
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement)
                            .getPropertyValue('--text-primary').trim()
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    titleColor: '#F97316',
                    bodyColor: '#FFFFFF',
                    titleFont: {
                        weight: 'bold'
                    },
                    padding: 12,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return '$' + context.raw.toLocaleString();
                        }
                    }
                }
            },
            hover: {
                mode: 'nearest',
                intersect: false,
                animationDuration: 200
            }
        }
    });
});
</script>
{% endblock %}